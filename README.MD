## 计算机网络课程设计 - 流量分析软件

### 课程设计背景

一台计算机，不管是个人电脑还是服务器，每时每刻都会有大量的网络数据包通过网卡发出或接收，对一般用户这些数据是透明的，因为网络传输是在后台默默进行的，一般用户很难对这些数据进行感知和分析。

如果能设计一种软件，能够实时监控这些数据，并且能根据用户需求图形化的展示给用户，就能大大提高网络传输的可见性和可分析性。
网络上已经有如Wireshark之类的抓包工具，但是它们有些对操作系统和网络环境有特定要求，有些操作难度过于复杂。尤其值得注意的是对于本身没有图形界面的操作系统或者目标机位于远程位置，一般只能在目标机上获取大量数据保存为文件，在下载到有图形界面的操作系统进行分析，便携性很差，且不能做到实时监控。

针对这样的问题，本次课程设计将设计一种能够跨平台的网络流量实时监控、分析软件，它将使用Java语言进行后台开发，而UI展示则使用web客户端的形式。之所以选择web方式展示，主要是针对没有图形界面的操作系统或目标机处于远程位置的情况，可以通过互联网将数据发至用户浏览器进行展示和分析。

在开发过程中，需要注意以下问题：

- 流量数据包属于机密信息，中途传输过程必须经过一定的加密处理，以保证资料不会被非法人员窃取，这也属于软件的一部分。
- 在捕获的过程中，应筛选排除属于本程序的网络流量，否则容易造成无限循环。

### 主要任务

#### 基本功能

- 具有可视化界面（GUI），暂定以网页方式实现
- 能够将报文在网络层和传输层逐字段展开
- 具有简单的过滤器设计功能
- 统计数据并表格显示，如统计IPv4报文、IPv6报文、UDP报文、TCP报文、ARP报文等
- 其中，IPv4和IPv6以柱状图统计、TCP、UDP和ARP以饼图显示
- 采集到的数据，可另存为一个文件，并能被自己的软件所读取和展示

#### 实际测试

软件必须安装在实际的一台机器上，并开启1天以上；该机器运行时，不影响机器正常使用；观察并记录软件消耗资源的情况，并作出分析。

#### 扩展功能（可选）

- 复杂过滤器的设计
- 异常数据的检测和报警
- 其它

### 技术可行性分析

#### 程序后台（数据模块）

##### 数据抓取：pcap4j库

Pcap4J是一款十分优秀的数据报文抓取第三方Java库，要自己编写报文抓取代码是十分困难的，但是在这个第三方库的支持下，对数据报文的抓取和处理将会容易，大大降低了开发难度。

##### Web交互：jetty库

本程序虽然以web作为主要展示端和控制端，但web后台并不是核心所在，所以只需要简单轻量的内嵌式web后台就足够了，jetty便是非常适合的库，配合servlet能比较容易的实现web后台。

##### WebSocket交互

WebSocket是前端获取数据的主要来源，但逻辑并不复杂，从pcap4j获取一个包，整理之后通过WebSocket发往前端就可以了，这里需要决定多个客户端的情况，以及是否支持多客户端，到实现的时候根据复杂度和逻辑设计再做决定。

##### 认证与加密

程序启动时生成随机token，依赖这个token进行认证。

由于使用单页面，并且使用了React，其实页面入口可以不需要认证，那么直接用浏览器地址#hash作为token来源来生成URL将是个很好的方案。Js获取token之后，打开WebSocket连接和调用后台API都将使用这个token进行认证和加密。（实际开发中将API统一整合到了WebSocket中）。

#### 程序前端（展示模块）

- 展示页面：单页面入口（React）
- 控制接口：servlet接口
- 数据获取接口：WebSocket接口

#### 数据分析与存储

##### 文件存取：原生pcap文件

Pcap4J库可以直接写入标准pcap文件，读取pcap文件可以使用io.pkts库。

##### 大量数据与性能：分页与动态读取

当数据量很大时，在一个页面显示会严重影响性能，甚至程序崩溃，必须做好分页。然而分页也需要一定的技巧，由于pcap文件本身是流式的，而且没有索引，所以很难从一个大的pcap文件中分页，只能采用多个文件的方式，借用操作系统的文件管理来辅助分页，规定一个文件最大存多少个包，这样就解决了后台分页问题。

还有就是前端的数据，除了能实时监控数据包之外，还应能够获取历史数据，另外当数据包越积越多，前端的内存消耗会越来越大，即使前端分页也无法缓解内存负荷，必须在合适的时间舍弃旧的数据包，需要的时候再向后台请求获取。

##### 数据分析：独立模块

本程序的数据分析主要有两种形式：一是从开始捕获数据包开始动态统计数据包类型，加以分析；二是从一个pcap文件中读取并分析。

这两种分析方式的分析过程是一样的，但是数据来源不同，如果能将分析程序独立出来，就能从不同的来源获取数据后使用统一的接口。另外，动态分析将是一直存在与全局空间的，只有一个，而文件分析则对应每一个文件，可以有多个。

### 时间进度安排

- 10月22日~10月26日：调研，需求分析，基本设计，提交课程设计任务书
- 10月27日~11月2日：程序后台功能（数据模块）实现
- 11月3日~11月9日：程序前端功能（展示模块）实现
- 11月10日~11月16日：程序数据分析模块实现
- 11月17日~11月23日：各模块整合联调
- 11月24日~11月28日：确认最终版本，生成输出数据
- 11月29日~12月9日：修改完善各种待提交的文档
- 12月10日~12月11日：制作答辩PPT
- 12月12日（周三）下午：答辩
